<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frame Analysis</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="/js/socket.js"></script>
    <script src="/js/frame-analysis.js" defer></script>
</head>
<body>
    <div class="container">
        <h1>First Frame Analysis</h1>
        <h2>Video: <%= filename.split('/').pop() %></h2>
        
        <div class="instructions">
            <h3>Instructions:</h3>
            <p>1. Select a colored point from the buttons below.</p>
            <p>2. Click on the image where you want to place the point.</p>
            <p>3. Once all points are placed, click "Save Point Positions".</p>
        </div>
        
        <div class="point-controls">
            <h3>Select point to place:</h3>
            <div id="pointRed" class="point-button point-red" data-index="0" data-color="red">Head</div>
            <div id="pointGreen" class="point-button point-green" data-index="1" data-color="green">Butt</div>
            <div id="pointBlue" class="point-button point-blue" data-index="2" data-color="blue">Left Side</div>
            <div id="pointPurple" class="point-button point-purple" data-index="3" data-color="purple">Right Side</div>
        </div>
        
        <div class="plotly-container" id="plotly-container">
            <!-- Plotly plot will be inserted here -->
            <%- plot_html %>
            <div id="plot-overlay"></div>
        </div>

        <div id="pointStatus" class="processing-status status-processing" style="display: none;">
            Select a point and click on the image to place it.
        </div>
        
        <div class="controls">
            <a href="/video/<%= encodeURIComponent(filename) %>" class="btn btn-primary">Back to Video Player</a>
            <a href="/" class="btn btn-secondary">Back to Video Library</a>
            <button id="savePlotlyPointsBtn" class="btn btn-action" onclick="savePoints()">Save Point Positions</button>
            <button id="processPointCloud" class="btn btn-action" onclick="processVideoWithPoints()">Process Point Cloud</button>
        </div>
    </div>

    <div id="processingLogs" class="processing-logs" style="display: none;">
        <h3>Processing Logs</h3>
        <div class="log-container">
            <pre id="logContent" class="log-content"></pre>
        </div>
    </div>
    
    <div id="processingStatus" class="processing-status">
        <span id="statusMessage"></span>
    </div>    

    <!-- Session data for JavaScript -->
    <script>
        const SESSION_ID = "<%= session_id %>";
        const VIDEO_PATH = "<%= filename %>";
    </script>
</body>
</html>